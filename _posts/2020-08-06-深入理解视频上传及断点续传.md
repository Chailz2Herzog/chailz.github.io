---
layout:post
title:"æ·±å…¥ç†è§£è§†é¢‘ä¸Šä¼ åŠæ–­ç‚¹ç»­ä¼ "
date:2020-07-30 19:30
header-img:"image/web/post-bg-2018-08-24.jpg"
catalog:true
tags:
- æ–‡ä»¶ä¸Šä¼ 
---

## å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ åŠæ–­ç‚¹ç»­ä¼ 

> æœ¬æ–‡ä¸­å®ç°æ–¹æ¡ˆä½¿ç”¨Rx + OkHttp å®ç°

### ä¸€ã€æ¦‚è¿°

åœ¨æ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­ï¼Œå¯æ ¹æ®æ–‡ä»¶å¤§å°ä½¿ç”¨ç®€å•ä¸Šä¼ ï¼ˆ`Simple Upload`ï¼‰æˆ–è€…å¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆåˆ†ç‰‡ä¸Šä¼ &æ–­ç‚¹ç»­ä¼ ï¼‰ï¼Œå¦‚æœä¸Šä¼ æ–‡ä»¶å¤§å°æœªçŸ¥ï¼Œåˆ™ä½¿ç”¨æµå¼ä¸Šä¼ ã€‚

<font color="orange">`ç®€å•ä¸Šä¼ `</font> é€‚ç”¨äºä¸€æ¬¡HTTPè¯·æ±‚äº¤äº’å³å¯å®Œæˆä¸Šä¼ åœºæ™¯ï¼Œæ¯”å¦‚å°æ–‡ä»¶ï¼ˆ<= 4MBï¼‰çš„ä¸Šä¼ ï¼›

<font color="orange">`å¤§æ–‡ä»¶ä¸Šä¼ `</font> é€‚ç”¨äºå¤§æ–‡ä»¶ï¼Œåˆ†ç‰‡å¤šæ¬¡HTTPè¯·æ±‚äº¤äº’ï¼Œæ–­ç‚¹ç»­ä¼ ï¼Œä¸Šä¼ ååˆ‡ç‰‡ç»„è£…æˆä¸ºå®Œæ•´æ–‡ä»¶åœºæ™¯ï¼›

* æ–­ç‚¹ç»­ä¼ ï¼šä¸­é€”æš‚åœä¹‹åï¼Œå¯ä»ä¸Šæ¬¡ä¸Šä¼ å®ŒæˆPartä½ç½®ç»§ç»­ä¸Šä¼ ï¼›
* åˆ†ç‰‡ä¸Šä¼ ï¼šå°†ä¸Šä¼ æ–‡ä»¶åˆ†ä¸ºè‹¥å¹²åˆ‡ç‰‡ï¼Œä¸Šä¼ æ—¶é‡‡ç”¨ `multipart/form-data` å®ç°ï¼Œä¸Šä¼ ç»“æŸåå°†åˆ‡ç‰‡é‡æ–°ç»„åˆæˆå®Œæ•´æ–‡ä»¶ï¼›

<font color="orange">`æµå¼ä¸Šä¼ `</font> ä¸Šä¼ æ–‡ä»¶å¤§å°æœªçŸ¥ï¼Œå¦‚è§†é¢‘ç›‘æ§ã€ç›´æ’­ç­‰ï¼›

### äºŒã€å‚æ•°

#### 2.1 Multipart/form-data
ç”¨äºè¿æ¥æ¶ˆæ¯ä½“çš„å¤šä¸ªéƒ¨åˆ†æ„æˆä¸€ä¸ªæ¶ˆæ¯ï¼ŒPOSTè¯·æ±‚ï¼Œæ”¯æŒå¤šå‚æ•°å¤šæ–‡ä»¶ï¼Œä¸Šä¼ å†…å®¹ä¸ºäºŒè¿›åˆ¶ã€‚

```
--11286958-fc05-4278-8f5d-09474d9f6f33
Content-Disposition: form-data; name="op"
Content-Length: 17

upload_slice_data
--11286958-fc05-4278-8f5d-09474d9f6f33
Content-Disposition: form-data; name="session"
Content-Length: 28

THFMb3NUbXNMTlRtc1BvdVRvbQ==
--11286958-fc05-4278-8f5d-09474d9f6f33
Content-Disposition: form-data; name="offset"
Content-Length: 7

1048576
--11286958-fc05-4278-8f5d-09474d9f6f33
Content-Disposition: form-data; name="filecontent"; filename="c59ceb20b8f44cd48227730ef02ab6f9.mp4"
Content-Type: application/octet-stream

ï¿½ï¿½bFï¿½ï¿½ï¿½Uï¿½|ï¿½J3?Ulï¿½ï¿½$u|ï¿½ï¿½Êï¿½ï¿½ï¿½Vcï¿½	Lï¿½-ï¿½ï¿½ï¿½n'ï¿½]Dï¿½?ï¿½ï¿½dï¿½oN%ï¿½ï¿½oï¿½ï¿½~Íµ2k;ï¿½&ï¿½ï¿½=?ï¿½ï¿½ß’ï¿½3ï¿½ï¿½ï¿½ï¿½|Q6y
```

å…¶ä¸­  `--11286958-fc05-4278-8f5d-09474d9f6f33` ç”¨æ¥åˆ†å‰²æ•°æ®è¾¹ç•Œï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œè‡ªåŠ¨è¯†åˆ«ä½œä¸ºè¾¹ç•Œã€‚`Content-Disposition` ä½œä¸ºæ¶ˆæ¯å¤´ï¼Œåœ¨Multipart bodyå£°æ˜å†…å®¹ä»¥`form-data`å±•ç°ï¼ˆWebæµè§ˆå™¨ä¸­ï¼Œå¯ä½œä¸º`inline`ã€`attachment`ï¼‰ï¼Œä»¥åŠå‚æ•°åkeyï¼Œ`Content-Length` å£°æ˜valueå€¼é•¿åº¦ï¼Œ`Content-Type` ç”¨äºæŒ‡ç¤ºèµ„æºçš„MIMEç±»å‹`media-type`ï¼ˆtextã€imageã€audioã€videoã€applicationäºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚

#### 2.2 RandomAccessFile

å¯è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå‘æ–‡ä»¶è¾“å‡ºæ•°æ®ï¼›å¯è‡ªç”±è®¿é—®æ–‡ä»¶ä»»æ„ä½ç½®ï¼Œä¸éœ€è¦ä»å¤´è¯»åˆ°å°¾ï¼›æ”¯æŒâ€œéšæœºè®¿é—®â€ï¼Œå…è®¸è‡ªç”±å®šä¹‰æ–‡ä»¶è®°å½•æŒ‡é’ˆï¼›

|åç§°|æ³¨è§£|
|---|---|
|seek(long pos)|è®¾ç½®å½“å‰æ–‡ä»¶è¯»å†™åç§»é‡ï¼ŒåŸºäºæ–‡ä»¶èµ·å§‹ä½ç½®|
|read(byte b[], int off, int len)||
|write(byte b[], int off, int len)||

#### 2.3 Sink&Source

Squareä¸‹çš„Okioåº“ï¼Œè¡¥å……java.ioå’Œjava.nioï¼›å¯ç†è§£ä¸ºInputStreamå’ŒOutputStreamï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—å†™å…¥ç¼“å­˜åŒºï¼Œè¯»å–ç¼“å­˜åŒºæ–¹æ³•ï¼›

| åç§°                    | æ³¨è§£                                    |
| ----------------------- | --------------------------------------- |
| writeAll(Source source) | sourceå†™å…¥ç¼“å­˜åŒºï¼Œè¿”å›å€¼: sourceæ€»bytes |
| source(File file)       | è¾“å…¥æµï¼Œè½¬æ¢ä¸ºSource                    |

#### 2.4 sha1

æ•°æ®åŠ å¯†ç®—æ³•ï¼Œå°†æ˜æ–‡è½¬æ¢ä¸ºæ•£åˆ—å€¼ã€[è¯¦è§£ SHA1 å®ç°](https://blog.csdn.net/ZCShouCSDN/article/details/84675235)ã€‘ï¼Œç”¨æ¥æ ¡éªŒæ–‡ä»¶å”¯ä¸€æ€§

### ä¸‰ã€å¤§æ–‡ä»¶ä¸Šä¼ 

æ–‡ä»¶ä¸Šä¼ å®è´¨æ˜¯å°†æ–‡ä»¶å˜æˆäºŒè¿›åˆ¶è¾“å…¥æµï¼Œå°†è¾“å…¥æµæ‰€æœ‰byteä¸Šä¼ åˆ°Serverç«¯ï¼Œå³ä¸Šä¼ æˆåŠŸã€‚è¾“å…¥æµä¸Šä¼ æ“ä½œä¸­å¯ä»¥å°†è¾“å…¥æµåˆ†æˆè‹¥å¹²byte[]æ•°ç»„æ¥ä¸Šä¼ ï¼Œæ¯æ¬¡ä¸Šä¼ ä¸€å®šé•¿åº¦çš„byte[]æ•°ç»„ï¼Œå³åˆ‡ç‰‡ä¸Šä¼ ï¼Œä»æŸä¸€å›ºå®šä½ç½®ï¼Œä¸Šä¼ byte[]æ•°ç»„ï¼Œå³æ–­ç‚¹ç»­ä¼ ã€‚

![na_upload_flow](../image/native/na_upload_flow.jpg)

å¤§æ–‡ä»¶ä¸Šä¼ ä¸»è¦å®ç°æ–¹æ¡ˆï¼š Multipart/form-dataæ”¯æŒã€Serverç«¯æ”¯æŒåˆ†ç‰‡ä¸Šä¼ /åˆ†ç‰‡åˆæˆã€æ–­ç‚¹ç»­ä¼ æ”¯æŒ

#### 3.1 åˆ‡ç‰‡ä¸Šä¼ 

ä¸»è¦å®ç°ç‚¹ï¼š

* æ–‡ä»¶åˆ‡ç‰‡
* è®¡ç®—åˆ‡ç‰‡åç§»é‡offsetï¼Œåˆ‡ç‰‡sha1å€¼ï¼Œå„åˆ‡ç‰‡byte
* æ„é€ åˆ‡ç‰‡ä¸Šä¼ è¯·æ±‚ã€åˆ‡ç‰‡åˆæˆè¯·æ±‚

æœ¬æ–‡ä¸»è¦å®ç°æ–¹å¼æ˜¯åŸºäºOKHttpå°è£…ï¼ŒOKHttp3å·²æ”¯æŒMultipartèƒ½åŠ›ï¼Œå¦‚è‹¥ä½¿ç”¨HttpUrlConnectionï¼Œéœ€è‡ªå·±æ‰‹åŠ¨å®ç°æ‹¼æ¥æ•°æ®ã€‚ã€[ä»åŸç†è§’åº¦è§£æAndroid ï¼ˆJavaï¼‰ http æ–‡ä»¶ä¸Šä¼ ](https://blog.csdn.net/lmj623565791/article/details/23781773)ã€‘

æ–‡ä»¶åˆ‡ç‰‡è®¡ç®—ï¼Œè·å–æ–‡ä»¶çš„æ€»å­—èŠ‚æ•°file.length()ï¼Œè‡ªå®šä¹‰åˆ†ç‰‡å¤§å°slice_sizeï¼Œåˆ‡ç‰‡ä¸Šä¼ æ—¶ï¼Œé€šè¿‡æ¯æ¬¡ç§»åŠ¨åç§»é‡offsetï¼Œä»0 ~ file.lengthï¼Œæœ€ç»ˆå°†æ–‡ä»¶åˆ†æˆè‹¥å¹²åˆ‡ç‰‡ï¼Œè¿›è¡Œä¸Šä¼ ã€‚æ¯æ¬¡åˆ‡ç‰‡ä¸Šä¼ éœ€æºå¸¦Serverä¸‹å‘çš„ `token` è¿›è¡ŒéªŒè¯ã€‚

```
private WosSliceUploadOffsetResp sliceFile(String auth, String session, int offset) throws Throwable {
        final RandomAccessFile randomAccessFile = new RandomAccessFile(mFileConfig.file, "r");
        final int fileSize = (int) file.length();
        WosSliceUploadOffsetResp currentOffsetResp = null;
        for (; offset < fileSize; offset += sliceSize) {
            if (isCanceled()) {
                return new WosSliceUploadOffsetResp(WosConstants.CODE_CANCEL, "cancel by user", session, offset, -1);
            }
            
            try {
            		RequestPair requestPair = generateSliceUploadRequest(auth, session, randomAccessFile, offset);
                mOkHttpCall = getOkHttpClient().newCall(requestPair.request);
                Response response = mOkHttpCall.execute();
                currentOffsetResp = new WosSliceUploadOffsetResp(new JSONObject(response.body().string()));
            } catch (Throwable e) {
                exception = e;
        		}
        return currentOffsetResp;
    }
```



åˆ‡ç‰‡ä¸Šä¼ è¯·æ±‚ï¼Œéœ€æ„é€ MultipartBodyï¼Œæ·»åŠ form-dataè‹¥å¹²å‚æ•°ï¼Œæ·»åŠ  `offset`ã€`filecontent`ã€`filename` å‘ŠçŸ¥æœåŠ¡ç«¯æœ¬æ¬¡åˆ‡ç‰‡ä¸Šä¼ åˆ°è¿œç«¯æ–‡ä»¶åï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹ï¼Œä»¥åŠåˆ†ç‰‡çš„åç§»é‡ã€‚

```
private RequestPair generateSliceUploadRequest(final String auth, final String session, 		final RandomAccessFile randomAccessFile, final int offset) throws IOException, JSONException, NoConnectionError {
        if (!NetworkHook.getInstance().isConnected()) {
            throw new NoConnectionError();
        }
        final int fileLeftSize = (int) (file.length() - offset);
        final int maxReadSize = fileLeftSize < sliceSize ? fileLeftSize : sliceSize;
        MultipartBody requestBody = new MultipartBody.Builder()
                .setType(MultipartBody.FORM)
                .addFormDataPart("op", "upload_slice_data")
                .addFormDataPart("session", session)
                .addFormDataPart("offset", String.valueOf(offset))
                .addFormDataPart("filecontent", uniqueName(), new RequestBody() {
                    @Override
                    public MediaType contentType() {
                        return WosConstants.MIME;
                    }

                    @Override
                    public void writeTo(BufferedSink bufferedSink) throws IOException {
                        randomAccessFile.seek(offset);
                        byte[] buf = new byte[4096];
                        int len = -1, countSize = 0, remainSize = 0;
                        while (countSize <= maxReadSize) {
                            if (isCanceled()) {
                                break;
                            }
                            remainSize = maxReadSize - countSize;
                            if (remainSize == 0) {
                                break;
                            }
                            len = remainSize > buf.length ? buf.length : remainSize;
                            len = randomAccessFile.read(buf, 0, len);
                            if (len == -1) {
                                break;
                            }

                            bufferedSink.write(buf, 0, len);
                            bufferedSink.flush();
                        }
                    }
                }).build();

        okhttp3.Request request = new okhttp3.Request
                .Builder()
                .url(mFileConfig.uploadUrl())
                .headers(headers)
                .post(requestBody)
                .build();
        return new RequestPair(request, offset + maxReadSize);
    }
```

åˆ‡ç‰‡ä¸Šä¼ åè¿”å›æ•°æ®æ ¼å¼

![slice_data_upload](../image/native/na_slice_data_upload.png)

åœ¨åˆ‡ç‰‡ä¸Šä¼ åï¼Œéœ€å‘é€åˆ‡ç‰‡åˆæˆè¯·æ±‚ï¼Œé€šçŸ¥Serverç«¯ï¼Œå°†å·²ä¸Šä¼ çš„è‹¥å¹²åˆ‡ç‰‡ï¼Œæ ¹æ®åç§»é‡ `offset`  åˆæˆå®Œæ•´çš„æ•°æ®æµï¼Œè½¬æ¢ä¸ºè¿œç«¯å­˜å‚¨çš„æ–‡ä»¶ï¼Œè¿”å›æœåŠ¡å™¨ç«¯å­˜å‚¨åœ°å€serverUrlã€‚



#### 3.2 æ–­ç‚¹ä¸Šä¼ 

åœ¨ä¸Šä¼ /ä¸‹è½½æ—¶ï¼Œå°†ä¸Šä¼ æˆ–è€…ä¸‹è½½æ–‡ä»¶ï¼Œç¢°åˆ°ç½‘ç»œæ•…éšœæˆ–è€…ä¸­æ–­è¡Œä¸ºï¼Œå¯ä»å·²ç»ä¸Šä¼ /ä¸‹è½½éƒ¨åˆ†ç»§ç»­å¼€å§‹ä¸Šä¼ /ä¸‹è½½æœªå®Œæˆçš„éƒ¨åˆ†ã€‚

##### 3.2.1 HTTPæ”¯æŒæ–­ç‚¹ç»­ä¼ 

HTTP 1.1ä¸­é»˜è®¤æ”¯æŒè·å–æ–‡ä»¶å†…å®¹ï¼Œé€šè¿‡ <font color="green">`Range`</font> å’Œ  <font color="green">`Content Range`</font> ï¼Œå®¢æˆ·ç«¯å‘è¯·æ±‚å¯¹åº”çš„Range ,æœåŠ¡ç«¯å¯¹åº”çš„æ˜¯ Content-Range 

##### 3.2.2 å®ç°æ–¹æ¡ˆ

![na_upload_breakpoint_flow](../image/native/na_upload_breakpoint_flow.png)



åˆ‡ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œæœ¬åœ°æ–‡ä»¶è®°å½•åˆ‡ç‰‡åç§»é‡ `offset` ï¼Œä¸Šä¼ æ—¶é—´ï¼Œåˆ‡ç‰‡å¤§å°`slicesize` ç­‰ä¿¡æ¯ï¼Œç­‰åˆ°ç½‘ç»œæ¢å¤æˆ–è€…é‡æ–°ä¸Šä¼ æ—¶ï¼Œç›´æ¥è¯»å–æœ¬åœ°æ–‡ä»¶è®°å½•ï¼Œä»ä¸Šæ¬¡åˆ‡ç‰‡ä¸Šä¼ ä¸­æ­¢çš„åœ°æ–¹é‡æ–°ä¸Šä¼ å‰©ä½™åˆ‡ç‰‡ã€‚

#### 3.3 ä¸Šä¼ è¿›åº¦

ä¸»è¦å®ç°ç‚¹ï¼š

* RandomAcessFileéšæœºè¯»å–ä¸Šä¼ æ–‡ä»¶
* BufferedSinkå†™å…¥æ•°æ®æµ

ä¸Šä¼ è¿›åº¦ä¾èµ–äº `RequestBody`ï¼Œé€šè¿‡æ„å»º  `RequestBody`  åœ¨å›è°ƒå¯å®æ—¶æ›´æ–°ä¸Šä¼ è¿›åº¦ã€‚æ¯ä¸€åˆ‡ç‰‡Requestè¯·æ±‚ä¸­ï¼Œæ·»åŠ form-dataæ•°æ®ï¼Œä½¿ç”¨  `addFormDataPart`  æ·»åŠ äºŒè¿›åˆ¶è¾“å…¥æµï¼Œåœ¨RequestBodyå›è°ƒä¸­ï¼Œå¯åŠ¨æ€è®¡ç®—æ•°æ®æµä¸Šä¼ è¿›åº¦ã€‚ä½¿ç”¨ `RandomAccessFile` çš„seek()å’Œread()æ–¹æ³•ï¼Œéšæœºè¯»å–ä¸Šä¼ æ–‡ä»¶çš„æŸä¸€é•¿åº¦æ€»å­—èŠ‚æ•°ï¼Œä¸æ­¤åŒæ—¶ä¿æŒå‘æœåŠ¡ç«¯å†™å…¥æ­¤æ€»å­—èŠ‚æ•°ï¼Œä»¥æ­¤è®¡ç®—ä¸Šä¼ è¿›åº¦ã€‚

```
private RequestPair generateSliceUploadRequest(){

		final int fileLeftSize = (int) (file.length() - offset);
		final int maxReadSize = fileLeftSize <sliceSize ? fileLeftSize : sliceSize;

		MultipartBody requestBody = new MultipartBody.Builder()
				.addFormDataPart(
						"filecontent",filename,new RequestBody(){
		
								@Override
								public void writeTo(BufferedSink bufferedSink) throws IOException {
										randomAccessFile.seek(offset);
										byte[] buf = new byte[4096];
    								int len = -1, countSize = 0, remainSize = 0;
    								while (countSize <= maxReadSize) {
       									int remainSize = maxReadSize - countSize;
        								if (remainSize == 0) {
        										break;
         								}
        								len = remainSize > buf.length ? buf.length : remainSize;
        								len = randomAccessFile.read(buf, 0, len);
        								if (len == -1) {
        										break;
        								}

        								bufferedSink.write(buf, 0, len);
        								bufferedSink.flush();
        								countSize += len;

        								int writtenBytes = offset + countSize;
       									//if (mIsBreakPointUpload) {
        								//	writtenBytes = mUploadedCountSize + countSize;
        								//}
        								final int hasWrite = writtenBytes;
        								notifyUi(new Runnable() {
        										@Override
            								public void run() {
            										if (mFileConfig.uploadListener != null) {
                										uploadListener.onProgress(mUploadResult.build(), (int) 
                												hasWrite, (int) mFileConfig.file.length());
                						}
                				}
                		});
            }
				}).build();
}
```

å¤§åˆ†ç‰‡è¿ç»­ä¸Šä¼ æ—¶ï¼šä¸Šä¼ è¿›åº¦ = offset + å½“å‰BufferedSink.write()çš„byteæ•° 

å°æ–‡ä»¶ä¸Šä¼ æ—¶ï¼šä¸Šä¼ è¿›åº¦ = BufferedSink.write() çš„byte ç´¯åŠ 



### 4 ä¸Šä¼ ä¼˜åŒ–

#### 4.1 ç§’ä¼ é¢„æ£€åŠŸèƒ½

å³å¯¹äºç›¸åŒå†…å®¹çš„æ–‡ä»¶æˆ–åˆ†ç‰‡å¯ä»¥ä¸å†è¿›è¡Œé‡å¤ä¸Šä¼ ã€‚é€šè¿‡è®¡ç®—æ–‡ä»¶æˆ–åˆ‡ç‰‡çš„sha1å€¼ï¼Œä½¿ç”¨é¢„æ£€æ¥å£ä¸æœåŠ¡ç«¯å­˜å‚¨çš„æ–‡ä»¶æˆ–åˆ‡ç‰‡sha1å€¼åšæ¯”å¯¹ï¼ŒæˆåŠŸåˆ™è¿”å›serverUrlï¼Œå¦åˆ™ç»§ç»­æ­£å¸¸ä¸Šä¼ æµç¨‹ã€‚

#### 4.2 ç§’ä¼ +ä¸Šä¼ è¿›åº¦

æœåŠ¡ç«¯æ”¯æŒç§’ä¼ é¢„æ£€åŠŸèƒ½åï¼Œå¯ä»é¢„æ£€æ¥å£è¿”å›ç»“æœå¾—åˆ°æ‰€æœ‰ä¸Šä¼ å¤±è´¥çš„åˆ‡ç‰‡ï¼Œå†æ¬¡è¿›è¡Œä¸Šä¼ ã€‚æ­¤æ—¶éœ€è¦é‡æ–°è®¡ç®—ä¸Šä¼ è¿›åº¦ï¼Œä¸Šä¼ è¿›åº¦ = å·²ä¸Šä¼ æˆåŠŸåˆ‡ç‰‡æ€»æ•°æ®é•¿åº¦ (<font color="orange">`datalen`</font>) + å½“å‰åˆ‡ç‰‡ä¸Šä¼ ä¸­BufferedSink.write()çš„æ€»byteæ•°

#### 4.3 Accept-Encoding/Content-Encoding

`accept-encoding` æ˜¯request headerså¤´éƒ¨å‚æ•°ï¼Œå‘Šè¯‰æœåŠ¡å™¨æ”¯æŒå‹ç¼©æ ¼å¼ï¼ˆ`gzip`ã€`deflate`ï¼‰; `content-encoding` æ˜¯response headerså¤´éƒ¨å‚æ•°ï¼Œè¡¨ç¤ºéœ€è¦æ ¹æ®content-encodingå€¼å¯¹HTTPè¯·æ±‚è¿”å›ä½“Responseè¿›è¡Œè§£ç ï¼›ä¸€èˆ¬ç»è¿‡gzipå‹ç¼©çš„æ–‡æœ¬ï¼Œåªæœ‰åŸå§‹å¤§å°çš„1/4ï¼›

#### 4.4 å¹¶å‘ä¸Šä¼ +ç§’ä¼ é¢„æ£€

å°†æ–‡ä»¶åˆ†ä¸ºè‹¥å¹²åˆ‡ç‰‡ï¼Œä½¿ç”¨çº¿ç¨‹æ± (ä¸€å®šæ•°ç›®çš„çº¿ç¨‹)ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸Šä¼ å•ä¸€åˆ‡ç‰‡(åˆ‡ç‰‡åç§»é‡ã€åˆ‡ç‰‡byteæ•°ã€åˆ‡ç‰‡sha1)ï¼Œè®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œè½®è¯¢æ‰€æœ‰çº¿ç¨‹ä¸Šä¼ æ‰€æœ‰åˆ‡ç‰‡ï¼Œè®°å½•ä¸Šä¼ å¤±è´¥çš„åˆ‡ç‰‡ã€‚ä¸‹æ¬¡ç»§ç»­ä¸Šä¼ æ—¶ï¼Œé’ˆå¯¹sha1åšæ ¡éªŒï¼Œå°†ä¸Šä¼ å¤±è´¥çš„åˆ‡ç‰‡é‡æ–°ä¸Šä¼ å³å¯ã€‚æ³¨æ„ç‚¹ï¼šéœ€è¦serverç«¯æ”¯æŒå¯æ ¹æ®åˆ‡ç‰‡æ–‡ä»¶ååŠåç§»é‡åšæ‰€æœ‰åˆ‡ç‰‡åˆæˆæ•´ä¸ªæ–‡ä»¶ã€‚ã€ä¸Šä¼ çš„ç“¶é¢ˆåœ¨ä¸Šè¡Œå¸¦å®½ï¼Œå¯èƒ½ä¸ä¼šå‡ºç°å¾ˆå¤šä¸ªåˆ‡ç‰‡ä¸€èµ·ä¸Šä¼ æƒ…å†µï¼Œéœ€è¦å®é™…æµ‹è¯•åˆ¶å®šçº¿ç¨‹æ•°ç›®ã€‘

---

[Android å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ](http://lastwarmth.win/2019/07/12/multi-form/?nsukey=UsCQx5x2pETa%2BBjIS4VVj9DNF5qBRKCuYiqWdCQhUBTHPeOW991XwxuTwYCFpmecZnyAucWZWJBW3tpHvnndnobso9hGrJcixy3homShtBo4XlRtsQ9UzQ7BG9gafVMq3ozlEVNNEvqwumDnX8x2j2F6mQ2uNCkk7RrjD9hO3Yk%2Be1bhRpUWQaOaEyJCbt3051%2F8xY3GabqZ4SzVUP8JyA%3D%3D)

[ä¸Šä¼ æ–‡ä»¶multipart/form-dataæ·±å…¥è§£æ](https://juejin.im/post/6844903810079391757)

[WebUploader æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–æ€»ç»“](https://my.oschina.net/kisshua/blog/701606)
